# ðŸŽ¨ Complete System Diagram

## Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    HEYGEN REBRANDING SYSTEM                         â”‚
â”‚                   Custom Login + Authenticated Proxy                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Component Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         USER'S BROWSER                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                         â”‚
                    â–¼                         â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  AUTH SERVER      â”‚     â”‚  PROXY SERVER     â”‚
        â”‚  Port 3002        â”‚     â”‚  Port 3000        â”‚
        â”‚                   â”‚     â”‚                   â”‚
        â”‚  - Custom UI      â”‚â”€â”€â”€â”€â–¶â”‚  - Load cookies   â”‚
        â”‚  - Playwright     â”‚     â”‚  - Inject auth    â”‚
        â”‚  - Save cookies   â”‚     â”‚  - Rebrand        â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚                         â”‚
                  â”‚                         â”‚
                  â–¼                         â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  PLAYWRIGHT       â”‚     â”‚  HEYGEN.COM       â”‚
        â”‚  Headless Chrome  â”‚â”€â”€â”€â”€â–¶â”‚  Original Site    â”‚
        â”‚                   â”‚     â”‚                   â”‚
        â”‚  - Navigate       â”‚     â”‚  - Authenticate   â”‚
        â”‚  - Fill forms     â”‚     â”‚  - Return content â”‚
        â”‚  - Extract cookiesâ”‚     â”‚                   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Data Flow

### 1ï¸âƒ£ Initial Login

```
USER                    AUTH SERVER              PLAYWRIGHT           HEYGEN
 â”‚                           â”‚                        â”‚                 â”‚
 â”‚  1. Visit localhost:3002  â”‚                        â”‚                 â”‚
 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                        â”‚                 â”‚
 â”‚                           â”‚                        â”‚                 â”‚
 â”‚  2. Show login UI         â”‚                        â”‚                 â”‚
 â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                        â”‚                 â”‚
 â”‚                           â”‚                        â”‚                 â”‚
 â”‚  3. Submit credentials    â”‚                        â”‚                 â”‚
 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                        â”‚                 â”‚
 â”‚                           â”‚                        â”‚                 â”‚
 â”‚                           â”‚  4. Launch browser     â”‚                 â”‚
 â”‚                           â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                 â”‚
 â”‚                           â”‚                        â”‚                 â”‚
 â”‚                           â”‚                        â”‚  5. Navigate    â”‚
 â”‚                           â”‚                        â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
 â”‚                           â”‚                        â”‚                 â”‚
 â”‚                           â”‚                        â”‚  6. Login page  â”‚
 â”‚                           â”‚                        â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
 â”‚                           â”‚                        â”‚                 â”‚
 â”‚                           â”‚                        â”‚  7. Fill email  â”‚
 â”‚                           â”‚                        â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
 â”‚                           â”‚                        â”‚                 â”‚
 â”‚                           â”‚                        â”‚  8. Continue    â”‚
 â”‚                           â”‚                        â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
 â”‚                           â”‚                        â”‚                 â”‚
 â”‚                           â”‚                        â”‚  9. Fill pass   â”‚
 â”‚                           â”‚                        â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
 â”‚                           â”‚                        â”‚                 â”‚
 â”‚                           â”‚                        â”‚  10. Login      â”‚
 â”‚                           â”‚                        â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
 â”‚                           â”‚                        â”‚                 â”‚
 â”‚                           â”‚                        â”‚  11. Dashboard  â”‚
 â”‚                           â”‚                        â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
 â”‚                           â”‚                        â”‚                 â”‚
 â”‚                           â”‚  12. Extract cookies   â”‚                 â”‚
 â”‚                           â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                 â”‚
 â”‚                           â”‚                        â”‚                 â”‚
 â”‚  13. Success + redirect   â”‚                        â”‚                 â”‚
 â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                        â”‚                 â”‚
 â”‚                           â”‚                        â”‚                 â”‚
 â”‚  14. Redirect to :3000    â”‚                        â”‚                 â”‚
 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
```

### 2ï¸âƒ£ Authenticated Browsing

```
USER                    PROXY SERVER                              HEYGEN
 â”‚                           â”‚                                      â”‚
 â”‚  1. Visit localhost:3000  â”‚                                      â”‚
 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                                      â”‚
 â”‚                           â”‚                                      â”‚
 â”‚                           â”‚  2. Load cookies from file           â”‚
 â”‚                           â”‚  (heygen-cookies.json)               â”‚
 â”‚                           â”‚                                      â”‚
 â”‚                           â”‚  3. Request with cookies             â”‚
 â”‚                           â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
 â”‚                           â”‚  Cookie: session=abc123...           â”‚
 â”‚                           â”‚                                      â”‚
 â”‚                           â”‚  4. Authenticated response           â”‚
 â”‚                           â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
 â”‚                           â”‚                                      â”‚
 â”‚                           â”‚  5. Apply rebranding                 â”‚
 â”‚                           â”‚  - Replace "HeyGen" â†’ "VideoAI Pro" â”‚
 â”‚                           â”‚  - Inject custom CSS                 â”‚
 â”‚                           â”‚  - Inject custom JS                  â”‚
 â”‚                           â”‚  - Replace logos                     â”‚
 â”‚                           â”‚                                      â”‚
 â”‚  6. Rebranded content     â”‚                                      â”‚
 â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                                      â”‚
 â”‚                           â”‚                                      â”‚
```

---

## File System

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      FILE STORAGE                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

heygen-storage.json          heygen-cookies.json
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Full browser     â”‚         â”‚ Extracted        â”‚
â”‚ storage state    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ cookies only     â”‚
â”‚                  â”‚         â”‚                  â”‚
â”‚ - Cookies        â”‚         â”‚ Used by proxy    â”‚
â”‚ - LocalStorage   â”‚         â”‚ for auth         â”‚
â”‚ - SessionStorage â”‚         â”‚                  â”‚
â”‚ - IndexedDB      â”‚         â”‚ [                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚   {              â”‚
                             â”‚     name: "..."  â”‚
     Created by              â”‚     value: "..." â”‚
     Playwright              â”‚   }              â”‚
     during login            â”‚ ]                â”‚
                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Request/Response Cycle

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DETAILED REQUEST FLOW                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. Browser Request
   â”œâ”€ GET http://localhost:3000/dashboard
   â””â”€ Headers: User-Agent, Accept, etc.

2. Proxy Middleware (Check Auth)
   â”œâ”€ Load cookies from heygen-cookies.json
   â”œâ”€ If no cookies â†’ redirect to :3002
   â””â”€ If cookies exist â†’ continue

3. Proxy Request Modification
   â”œâ”€ Add cookies to request
   â”‚  â””â”€ Cookie: session=abc; token=xyz
   â”œâ”€ Set referer: https://app.heygen.com
   â”œâ”€ Set origin: https://app.heygen.com
   â””â”€ Forward to HeyGen

4. HeyGen Processing
   â”œâ”€ Validate cookies
   â”œâ”€ Authenticate user
   â”œâ”€ Process request
   â””â”€ Return response

5. Proxy Response Modification
   â”œâ”€ Remove security headers
   â”‚  â”œâ”€ content-security-policy
   â”‚  â””â”€ x-frame-options
   â”œâ”€ Parse HTML
   â”œâ”€ Replace text
   â”‚  â””â”€ "HeyGen" â†’ "VideoAI Pro"
   â”œâ”€ Inject CSS
   â”‚  â””â”€ Custom colors, hide logos
   â”œâ”€ Inject JavaScript
   â”‚  â””â”€ Dynamic rebranding, MutationObserver
   â””â”€ Return modified response

6. Browser Rendering
   â”œâ”€ Receive rebranded HTML
   â”œâ”€ Load custom CSS
   â”œâ”€ Execute custom JS
   â”œâ”€ Apply branding
   â””â”€ Display to user
```

---

## Authentication State Machine

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   AUTHENTICATION STATES                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ NOT          â”‚
        â”‚ AUTHENTICATEDâ”‚
        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”‚ User visits :3002
               â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ LOGIN        â”‚
        â”‚ PAGE         â”‚
        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”‚ Submit credentials
               â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ PLAYWRIGHT   â”‚
        â”‚ AUTHENTICATINGâ”‚
        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”‚ Success
               â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ COOKIES      â”‚
        â”‚ SAVED        â”‚
        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”‚ Redirect to :3000
               â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ AUTHENTICATEDâ”‚â—€â”€â”€â”€â”€â”€â”
        â”‚ BROWSING     â”‚      â”‚
        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
               â”‚              â”‚
               â”‚ Each request â”‚
               â–¼              â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
        â”‚ PROXY INJECTSâ”‚      â”‚
        â”‚ COOKIES      â”‚â”€â”€â”€â”€â”€â”€â”˜
        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”‚ Session expires
               â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ REDIRECT TO  â”‚
        â”‚ LOGIN        â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Server Startup Sequence

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    STARTUP SEQUENCE                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

$ npm start
    â”‚
    â”œâ”€ 1. Check node_modules
    â”‚     â””â”€ If missing: npm install
    â”‚
    â”œâ”€ 2. Kill existing processes
    â”‚     â”œâ”€ lsof -ti:3000 | xargs kill -9
    â”‚     â””â”€ lsof -ti:3002 | xargs kill -9
    â”‚
    â”œâ”€ 3. Start Auth Server
    â”‚     â”œâ”€ node auth-server.js &
    â”‚     â”œâ”€ PID: 12345
    â”‚     â”œâ”€ Load saved cookies (if exist)
    â”‚     â””â”€ Listen on :3002
    â”‚
    â”œâ”€ 4. Start Proxy Server
    â”‚     â”œâ”€ node proxy-with-auth.js &
    â”‚     â”œâ”€ PID: 12346
    â”‚     â”œâ”€ Load saved cookies (if exist)
    â”‚     â””â”€ Listen on :3000
    â”‚
    â”œâ”€ 5. Save PIDs to .pids
    â”‚     â””â”€ 12345\n12346
    â”‚
    â””â”€ 6. Show logs
          â””â”€ tail -f logs/*.log
```

---

## Rebranding Pipeline

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   REBRANDING PIPELINE                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Original HTML from HeyGen
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Server-side        â”‚
â”‚ Text Replacement   â”‚
â”‚                    â”‚
â”‚ "HeyGen"           â”‚
â”‚    â†“               â”‚
â”‚ "VideoAI Pro"      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Remove Security    â”‚
â”‚ Headers            â”‚
â”‚                    â”‚
â”‚ - CSP              â”‚
â”‚ - X-Frame-Options  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Inject Custom CSS  â”‚
â”‚                    â”‚
â”‚ - Colors           â”‚
â”‚ - Hide logos       â”‚
â”‚ - Button styles    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Inject Custom JS   â”‚
â”‚                    â”‚
â”‚ - Text replacer    â”‚
â”‚ - Logo replacer    â”‚
â”‚ - MutationObserver â”‚
â”‚ - Logout button    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
Modified HTML to Browser
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Client-side        â”‚
â”‚ Dynamic Updates    â”‚
â”‚                    â”‚
â”‚ MutationObserver   â”‚
â”‚ watches for new    â”‚
â”‚ content and        â”‚
â”‚ rebrands it        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Cookie Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      COOKIE LIFECYCLE                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. Login via Playwright
   â””â”€ HeyGen sets cookies in browser

2. Extract Cookies
   â”œâ”€ const cookies = await context.cookies()
   â””â”€ [
       { name: "session", value: "abc123", domain: ".heygen.com" },
       { name: "token", value: "xyz789", domain: ".heygen.com" }
     ]

3. Save to File
   â””â”€ fs.writeFileSync('heygen-cookies.json', JSON.stringify(cookies))

4. Proxy Loads Cookies
   â””â”€ const cookies = JSON.parse(fs.readFileSync('heygen-cookies.json'))

5. Convert to Header
   â””â”€ Cookie: session=abc123; token=xyz789

6. Inject in Requests
   â””â”€ proxyReq.setHeader('cookie', cookieHeader)

7. HeyGen Validates
   â””â”€ Recognizes authenticated session

8. Session Expires
   â””â”€ HeyGen returns 401/403

9. Redirect to Login
   â””â”€ User logs in again

10. Cycle Repeats
```

---

## Port Mapping

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       PORT MAPPING                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

localhost:3002                localhost:3000
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AUTH SERVER  â”‚             â”‚ PROXY SERVER â”‚
â”‚              â”‚             â”‚              â”‚
â”‚ Endpoints:   â”‚             â”‚ Proxies:     â”‚
â”‚ GET  /       â”‚             â”‚ GET  /*      â”‚
â”‚ POST /api/   â”‚             â”‚ POST /*      â”‚
â”‚   login      â”‚             â”‚ PUT  /*      â”‚
â”‚ GET  /api/   â”‚             â”‚ DELETE /*    â”‚
â”‚   status     â”‚             â”‚ WS   /*      â”‚
â”‚ POST /api/   â”‚             â”‚              â”‚
â”‚   logout     â”‚             â”‚ Serves:      â”‚
â”‚ GET  /api/   â”‚             â”‚ /custom-     â”‚
â”‚   cookies    â”‚             â”‚   assets/*   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                            â”‚
       â”‚                            â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ app.heygen.com   â”‚
              â”‚                  â”‚
              â”‚ - Authenticate   â”‚
              â”‚ - Process        â”‚
              â”‚ - Return data    â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Summary

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SYSTEM SUMMARY                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Components:
  âœ… Custom login UI (beautiful, branded)
  âœ… Playwright authentication (automated, headless)
  âœ… Session persistence (cookies saved to file)
  âœ… Authenticated proxy (injects cookies)
  âœ… Complete rebranding (text, colors, logos)
  âœ… Dynamic updates (MutationObserver)
  âœ… Logout functionality (clean session end)

Flow:
  1. User â†’ Custom login (port 3002)
  2. Playwright â†’ Authenticate with HeyGen
  3. Cookies â†’ Saved to file
  4. Redirect â†’ Proxy (port 3000)
  5. Proxy â†’ Inject cookies in all requests
  6. HeyGen â†’ Return authenticated content
  7. Proxy â†’ Rebrand and serve
  8. User â†’ See rebranded HeyGen

Result:
  ðŸŽ‰ Fully functional HeyGen with your branding!
```

---

**This is the complete system architecture!** ðŸŽ¨
